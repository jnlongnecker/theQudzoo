<template>
    <c-popup>
        <template if:true={levelOne}>
            <span slot="header">:choose variant:</span>
            <ul class="insert-variant">
                <template for:each={variantChoices} for:item="variant" for:index="i">
                    <li key={variant.name}>
                        <button class="v-button" data-index={i} onclick={variantChosen}>
                            {variant.type}
                        </button>
                    </li>
                </template>
            </ul>
        </template>
        <template if:false={levelOne}>
            <span slot="header">:{selectedMutation}:</span>
            <div class="popup-container">
                <div>
                    <p>Current Level</p>
                    <build-markdown-renderer modes="all-qud-font bolded inline no-highlight" slow-load shaders-only
                        raw-text={selectedText}></build-markdown-renderer>
                </div>
                <span class="divider">
                    <svg width="30" height="150">
                        <path d="M0 0 L30 75 L0 150 Z"></path>
                    </svg>
                </span>
                <div>
                    <p>Next Level</p>
                    <build-markdown-renderer modes="all-qud-font bolded inline no-highlight" slow-load shaders-only
                        raw-text={selectedTextLevelUp}></build-markdown-renderer>
                </div>
            </div>
            <input-button slot="input" onclick={cancelRankUp}>Cancel</input-button>
            <input-button slot="input" onclick={confirmRankUp}>Confirm</input-button>
        </template>
    </c-popup>
    <section if:true={levelOne}>
        <div class="mutations">
            <template for:each={mutations} for:item="category">
                <fieldset key={category.id}>
                    <legend class={category.class}>{category.data.displayName}</legend>
                    <ul>
                        <template for:each={category.data.mutations} for:item="mut">
                            <template if:true={mut.selectable}>
                                <div class="selectable" key={mut.name} onmouseenter={mutHover} onclick={mutClick}
                                    data-name={mut.name} data-category={category.data.name}>
                                    <div class={mut.format}>
                                        <div class="mutation-line">
                                            <span>
                                                [<span class="marker">{mut.marker}</span>]
                                            </span>
                                            <span>
                                                [<span class="positive">{mut.cost}</span>]
                                            </span>
                                            <span class="mutation-name">
                                                {mut.displayName}
                                            </span>
                                            <div class="variations" if:true={mut.variants}>
                                                <button class="v-button" onclick={chooseVariant}
                                                    data-category={category.data.name}
                                                    data-name={mut.name}>Variant</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <template if:false={mut.selectable}>
                                <div class="disabled" key={mut.name} onmouseenter={mutHover} data-name={mut.name}
                                    data-category={category.data.name}>
                                    <div class={mut.format}>
                                        <div class="mutation-line">
                                            <span>
                                                [<span class="marker">{mut.marker}</span>]
                                            </span>
                                            <span>
                                                [<span class="positive">{mut.cost}</span>]
                                            </span>
                                            <span class="mutation-name">
                                                {mut.displayName}
                                            </span>
                                            <div class="variations" if:true={mut.variants}>
                                                <button class="v-button" onclick={chooseVariant}
                                                    data-category={category.data.name}
                                                    data-name={mut.name}>Variant</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>

                        </template>
                    </ul>
                </fieldset>
            </template>
        </div>
        <hr />
        <div class="blurb" onclick={hideBlurb}>
            <fieldset>
                <legend class="legend-img">
                    <img if:true={selectedSrc} src={selectedSrc} class="mut-img" />
                </legend>
                <div class="blurb-format">
                    <span>{selectedMutation}</span>
                    <build-markdown-renderer modes="all-qud-font bolded inline no-highlight" slow-load shaders-only
                        raw-text={selectedText} if:true={selectedText}></build-markdown-renderer>
                </div>
            </fieldset>
        </div>
    </section>
    <section if:false={levelOne}>
        <div class="mutations">
            <fieldset>
                <legend>
                    Mutations
                </legend>
                <ul>
                    <template for:each={mutationList} for:item="mut">
                        <div class="selectable" key={mut.name} onmouseenter={mutHover} onclick={upgradeMutation}
                            data-name={mut.name} data-category={mut.category}>
                            <div>
                                <div class="mutation-line-leveled">
                                    <span>
                                        {mut.displayName}
                                    </span>
                                    <span if:true={mut.rank}>
                                        ({mut.rank})
                                    </span>
                                </div>
                            </div>
                        </div>
                    </template>
                </ul>
            </fieldset>
        </div>
        <hr />
        <div class="blurb">
            <fieldset>
                <legend class="legend-img">
                    <img if:true={selectedSrc} src={selectedSrc} class="mut-img" />
                </legend>
                <div class="blurb-format">
                    <span>{selectedMutation}</span>
                    <build-markdown-renderer modes="all-qud-font bolded inline no-highlight" slow-load shaders-only
                        raw-text={selectedText} if:true={selectedText}></build-markdown-renderer>
                </div>
            </fieldset>
        </div>
    </section>
    <div class="options">
        <span>Points Remaining: {mutationPoints}</span>
    </div>
</template>